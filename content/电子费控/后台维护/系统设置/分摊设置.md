---
aliases: ["1969759263422251092"]
title: 分摊设置
created: 2025-07-15
modified: 2025-07-15
tags: ['基础模块']
theme: 电子费控
---

**一、功能描述**

在提交报销单时就可将费用按照不同承担主体 （ 如部门 、 人员 、 项目等 ） 进行分摊，支持承担主体组合、预设分摊方案。

**二、功能说明**

1、如图所示，填写分摊规则名称后点击【保存并进入下一步】，可在基本规则tab页设置分摊维度

（1）系统维度：目前支持部门、项目、人员、客户（其中项目、客户需要购买了对应的模块后才可使用，否则不显示）

（2）自定义分摊维度：为了满足更个性化的需求，支持自定义维度分摊维度（该功能是通过引用ebuilder表单实现，因此未采购eb时不可使用该功能）

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/2909448cb5289a33b42193c6b57621dd.jpg)

说明：

①新建分摊规则页面，默认启用分摊规则；分摊规则名称必填，可重复；分摊维度组合目前支持部门、项目、人员、客户及自定义维度，可多选；

②不同的分摊规则，分摊维度组合不能重复；

③当分摊规则在前台分摊设置中已经被选择，且产生分摊明细数据，在分摊设置页面不可以删除该分摊规则；

④当分摊设置页面分摊规则设置为未启用，不影响之前已经存在的数据，后续在前台分摊设置按钮中，不能再选择到该分摊规则进行分摊明细设置；

2、如图所示，可预设分摊方案。常用于存在固定分摊比例的费用，比如水电费、房租等。

**![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/936f911dd2219fe8d34c513f94fa96c9.jpg)**

3、如图所示，【表单设置】页面报销字段对应增加两个字段：分摊设置和分摊金额

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/0912d6943d6cfb35647b45bfbe4467bb.jpg)

说明：

① 仅支持高级模式表单，系统默认初始化的表单不支持分摊功能，且仅支持对应明细表字段，暂不支持主表字段；

② 费用分摊对应单行文本字段，在前台呈现的是一个设置按钮；

③ 分摊金额可对应报销金额字段，数字或金额类型都可；

4、如图所示，设置分摊字段对应后前台发起申请，对应费用分摊的表单字段呈现的是一个设置按钮

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/69ee4360cb74103b303aea5b82acd99e.jpg)

说明：

①流程需要先保存，才能点击设置按钮进入详情页面；否则弹出提示“请先保存流程，再设置”；

②流程明细表需要先填写后台字段对应中的分摊金额字段，才能点击设置按钮进入分摊明细设置页面，否则弹出提示窗口：暂无可分摊的费用；

4、如图所示进入分摊设置页面后，选择启用状态的分摊规则（如果分摊明细有数据，切换规则后，会清空原有明细）。若本次分摊的费用是固定分摊，可引用已有的分摊方案。选择分摊方案后，根据所选方案自动带出预设分摊明细，分摊金额依据分摊比例自动计算出来。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/ae9e8bde13af597cd9d68d65dcaaca2f.jpg)说明：

①分摊明细中，承担金额、承担比例是固定显示的，其它列由所选分摊规则的维度组合确定；

②填写承担金额会自动计算承担比例，填写承担比例会自动计算承担金额；

③分摊金额要等于承担金额总和，否则无法保存。如果出现因四舍五入导致承担金额之和不等于分摊金额时，可点击【填充余额】，系统将自动把剩余的金额补充到最后一行分摊明细上。

④当选择分摊方案后，右下角增加重置按钮，作用是：重新根据方案带出分摊明细。使用场景：如果之前选择方案带出数据有调整，增加了分摊明细、调整了分摊金额等，那么会导致与原方案分摊明细不一致，要恢复到按最新方案明细显示，则只需要点击重置即可。

另关于小数位位数处理说明：此处的承担金额默认保留两位小数

**5、费用分摊在ESB相关的配置**

由于存在后续节点流程表单金额字段可编辑的情况，导致分摊明细中的金额和流程表单填的报销金额不一致。需要设置分摊校验动作，每次提交流程都去校验报销金额和分摊明细总金额是否一致，不一致就无法提交，一致就允许提交。

**![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/ef80eb84ddb9ef88dfa6a67fb944e9a8.jpg)**

（1）首先选择流程触发，配置需要使用分摊的工作流；

（2）第二步：选择执行动作为【费用分摊】，选择流程选择动态赋值，选择上下文：流程触发-流程数据中的流程标识（只能选择这个）；

（3）第三步：选择组件【条件分支】，用于根据分摊校验执行结果走不同的处理方式（成功了怎么做，失败了怎么做），条件设置选择上下文的分摊校验组件-响应数据中的动作流执行结果；

（4）第四步：选择组件【输出】，动作流执行结果=是，代表执行成功，输出组件什么都不用动；

其它条件就代表失败，输出组件状态选择失败，提醒内容选择错误-动态赋值，浏览框内容选择上下文的分摊校验组件-响应数据中的动作流执行信息；

（5）esb动作流详细介绍[[待下载-未知ID_1965310270006533359|点击此处]]

**6、使用过程描述**

（1）云报销-设置-分摊设置页面先设置分摊规则；

（2） 云报销设置-表单设置页面进行字段对应，需要先在表单设计器中添加两个明细表字段：单行文本字段和数字或者金额字段；

（3） 配置分摊校验的动作流；

