---
aliases: ["1968932497207841036"]
title: 企业微信集成
created: 2025-07-15
modified: 2025-07-15
tags: ['云桥']
theme: 云桥
---

**一、概述**

支持与企业微信系统集成，包括“通讯录同步”“应用集成到企业微信"”消息互通“，即实现在企业微信上使用我们的应用，包括推送消息。

**二、操作说明**

[[#企业集成|1. 企业集成]]

[[#应用集成|2. 应用集成]]

[[#企业微信管理后台创建应用|2.1 企业微信管理后台创建应用]]

[[#可信域名校验|2.2 可信域名校验]]

[[#云桥集成应用|2.3 云桥集成应用]]

[[#配置应用菜单|2.4 配置应用菜单]]

[2.5 构造免登链接](http://构造免登链接)

[[#消息推送|3. 消息推送]]

[[#消息规则配置|3.1 消息规则配置]]

[[#文字|3.1.1 文字]]

[[#图文|3.1.2 图文]]

[[#文本卡片|3.1.3 文本卡片]]

[[#模板卡片|3.1.4 模板卡片]]

[[#消息撤回|3.2 消息撤回]]

[[#通讯录同步|4. 通讯录同步]]

[[#前提|4.1 前提]]

[[#同步功能相关配置|4.2 同步功能相关配置]]

[[#从企业微信同步组织用户绑定|4.2.1 从企业微信同步组织用户绑定]]

[[#是否同步到OA|4.2.2 是否同步到OA]]

[[#同步通讯录到企业微信|4.2.3 同步通讯录到企业微信]]

[[#用户绑定/解绑|4.2.4 用户绑定/解绑]]

[[#同步功能使用说明|4.3 同步功能使用说明]]

[4.3.1 以企业微信组织架构为准](http://以企业微信组织架构为准)

[4.3.2 以OA组织架构为准](http://以OA组织架构为准)

[4.3.2.1 企业微信没有组织架构](http://企业微信没有组织架构)

[[#企业微信有组织架构|4.3.2.2 企业微信有组织架构]]

[[#其他注意事项|4.3.3 其他注意事项]]

[[#考勤同步|5. 考勤同步]]

[[#扫码登录|6. 扫码登录]]

[[#客户管理|7. 客户管理]]

[[#功能配置|7.1 功能配置]]

[[#外部联系人列表|7.2 外部联系人列表]]

7[[#外部联系人手动同步|.2.1 外部联系人手动同步]]

[7.2.2 外部联系人自动同步](http://外部联系人自动同步)

[[#消息存档|8. 消息存档]]

[[#其他功能说明|9. 其他功能说明]]

[[#聊天工具栏|9.1 企业微信-聊天工具栏+工具栏配置]]

[[#更多设置|9.2 更多设置]]

# **【云桥对外域名】配置**

集成企业微信需要配置外网域名地址，在【云桥】-【基础参数设置】配置当前系统的外网域名地址，配置好之后点击保存；

![](30b6cb86bab3f50171d09b29c0bd4d4c.jpg)

**注意：**

**1. 若用户集成的是私有化部署的企业微信，不强制要求开通外网域名，云桥外网地址可以直接填写当前私有化系统的内网IP地址；**

**2.若用户集成的非私有化部署的企业微信，需要开通外网域名。**

**【开通服务器网络权限的说明】**

1.如果使用本系统进行企业微信集成功能，则需要调用企业微信接口，并且最终用户是通过企业微信来使用集成的功能，所以本系统部署的云桥服务器必须要求，能够访问外网：即开通这台服务器的上网权限，让云桥服务器能够访问互联网，如果贵公司对网络安全要求较高，至少需要让这个服务器能够访问以下地址：  
企业微信API：https://qyapi.weixin.qq.com  
（如果是政务微信，需要把qyapi.weixin.qq.com换成政务微信的服务地址）  
2.同时请网络管理员将本系统的访问地址映射到外网。  
3.可以用如下方式验证网络是否通畅：  
企业微信（如果是政务微信，需要把qyapi.weixin.qq.com换成政务微信的服务地址测试）  
在云桥服务器上按如下方式检查网络：  
ping qyapi.weixin.qq.com 查看是否能ping通  
Windows:  
浏览器访问 https://qyapi.weixin.qq.com/cgi-bin/gettoken 查看是否有返回结果  
Linux:  
执行命令 curl https://qyapi.weixin.qq.com/cgi-bin/gettoken 查看是否有返回结果

# **1. 企业集成**

企业微信接入功能主要是在云桥中建立企业微信接入信息，将基本的企业CorpID等写入云桥中；

① 点击后台管理中心，在所有服务中选择云桥或者平台引擎里点击云桥，即可进入云桥页面，如下图所示：

![](09d2f44ca17c3e6e788fffea27272e29.jpg)

② 访问【企业微信集成】菜单，点击右上角【新建企业微信】，如下图所示：

![](e6b5abe7d5744b6afe624d4f8e2e7bf6.jpg)

③ 输入企业名称以及企业corpid，如下图所示：

![](5f588ca89d3805991795d21a85846252.jpg)

④ 其中CorpID获取方式：请登录企业微信管理后台https://work.weixin.qq.com/wework\_admin/loginpage\_wx?from=myhome，在【我的企业】获取CorpID，如下图：

![](a7428efb94d7a5df8ddb16be2d6f837b.jpg)

**注意：私有化部署的企业微信，需要修改API服务地址！！！**

![](a82886df03c024ea8f5e9b23027ab24e.jpg)

# 2. **应用集成**

## **2.1企业微信管理后台创建应用**

① 请登录企业微信管理后台https://work.weixin.qq.com/wework\_admin/loginpage\_wx?from=myhome，进入【应用管理】，点击【创建应用】，如下图：

![](ac08636dbca25cf02c3e3f73fd2b30a9.jpg)

② 创建应用后，即可获取到AgentID、Secret，如下图所示：

![](288be3ebaec978e0fa04c8be1203aed3.jpg)

## **2.2可信域名校验**

**注意：2.2点可信域名校验是对非私有化企业微信域名校验的说明。**

**私有化部署的企业微信对域名不做强制要求！！！可跳过该步骤！！！若需要校验网页授权及JS-SDK可参考：**https://yq.weaver.com.cn/eb/qa/view/#/question/bb1f037fdda54d35980f8bd0af335437**

① 访问当前集成的企业微信团队，点击【基础信息设置】，打开企业微信基础设置页面，获取可信域名；

![](75d33ef984da228c47774c782c7d7fc5.jpg)

![](d1b9a814342f1a0b1d48b7ce74ca5ca0.jpg)

② 将域名配置到企业微信管理后台对应的应用网页授权及JS-SDK 中：访问企业微信管理后台-【应用管理】，找到对应的应用，点击【网页授权及JS-SDK】中的【设置可信域名】 ；

![](bbbc5a7c43645f727162115ccf233591.jpg)

③ 在可信域名中填写第一点复制过来的外网域名，填写完成之后，点击【申请校验域名】，具体填写格式说明可参考 https://yq.weaver.com.cn/eb/qa/view/#/question/7e60e7cbf03b45779ff6ef4b481b2868 的 第2 点。

![](9b416ddca808be1fc9a0ee512db76232.jpg)

④ 下载界面上的txt文件；

![](12c3b727976377f6a6e8133e9d89608e.jpg)

⑤ 在当前企业微信团队【基本设置】页面，上传第四点下载的txt 文件；

![](ab75db320facac7de58e17a89f397b88.jpg)

⑥ 文件上传后，点击确定；

![](f7cebf44f724c9db41fab9635859b70e.jpg)

### **2.2.1 企业微信域名校验常见问题**

请点击此链接查看：**https://yq.weaver.com.cn/eb/qa/view/#/question/7e60e7cbf03b45779ff6ef4b481b2868**

## **2.3云桥集成应用**

① 访问云桥【企业微信集成】，在当前集成的企业微信页面，点击【添加应用】，如下图：

![](36775af6520c35153737ba7c12dcbbba.jpg)

② 进入应用详情页面，填写企业微信应用的应用名称、AgentID、Secret【步骤2.1中获取到的应用信息】，如下图：

![](04208af1cbbd351abf67d49a3b7fdc06.jpg)

③ 配置应用的企业可信IP：在应用详情页可以复制公网IP

![](cc53eee56f62e016f5021b14a4e93abf.jpg)

④ 访问企业微信管理后台-【应用管理】，找到对应的应用；

![](1299d5664b5a08880d477d02d1dc05ef.jpg)

⑤ 在具体应用-【开发者接口】-【企业可信IP】中填写上刚刚复制的公网ip；

![](803a8687600e510be31ef71150ad6f4a.jpg)

⑥ 应用主页 是设置企业微信应用的主页功能，调用模块默认为打开应用，选择应用中心已经存在的主页型应用，如下图所示：

![](75616ccb39f6dfaadf75ece30f5eeaf4.jpg)

也支持自定义链接地址，如下图：

![](b9d2bacff967473962a68b849fd69fd2.jpg)

**2.4配置应用菜单**

用户可以根据需求，设置菜单地址，设置完成后，点击**保存**，会自动发布到企业微信管理后台的应用菜单里：

![](42e4e3572037d760a0c4e0355a38f7ab.jpg)

发布到企业微信管理后台的效果：

![](48d9671d5ea501dfa982241eb8f7886d.jpg)

企业微信端实现的功能效果：

![](62b7fd208e9f61bf4f70a8e9c3b43c6d.jpg)

![](4e15477842f044d625fedd25d8369fe8.jpg)

若没有自动发布到企业微信，可以根据以下方法手动将菜单配置到企业微信：先复制出菜单地址

![](7f838211cfd26c7960afe3739d5168bb.jpg)

将复制的菜单地址配置到企业微信：访问企业微信管理后台https://work.weixin.qq.com/wework\_admin/loginpage\_wx，找到对应的应用，设置应用菜单；

![](0bef3b07b7ecfe57dc768129adca181b.jpg)

![](f0e4fb77661b585071d2c311acfce071.jpg)

**2.5构造免登链接**

需求背景：用户需要在企业微信端免登打开OA的业务地址，例如流程、表单、文档等，可以通过在OA业务地址后面加上云桥的单点参数来实现。

云桥单点参数格式如下：

wea\_link\_keep\_ebAgentKey=需要替换成实际的应用参数&wea\_link\_keep\_ebCorpKey=需要替换成实际的企业参数&wea\_link\_keep\_ebTenantKey=需要替换实际的租户识别码

![](f4bd01688d4f5e05a4cd47e82460e2c1.jpg)

![](a267df8ac29ee8f3f8f72cb69cdf575c.jpg)

例如：wea\_link\_keep\_ebAgentKey=830265179035746304&wea\_link\_keep\_ebCorpKey=783254141977542657&wea\_link\_keep\_ebTenantKey=to74i5mdhw

直接在需要打开的OA地址后面加上参数即可：

[[待下载-未知ID_871109798170779649|http://testpg.test.eteamswork.cn/sp/workflow/flowpage/fullView/871109798170779649?secondEmpId=775003999577841665&requestId=871109798170779649&wea\_link\_keep\_ebAgentKey=830265179035746304&wea\_link\_keep\_ebCorpKey=783254141977542657&wea\_link\_keep\_ebTenantKey=to74i5mdhw]]

![](da3015e00a4cacdea6c89b72ef4222d2.jpg)

例如，不是 通过云桥推送的公告消息，里面的放了E10的文档附件链接，需要能在企业微信免登打开；

将构造的带云桥单点参数的链接地址，放到公告消息附件链接里面，点击附件，实现在企业微信免登打开：

![](69ec66e00193ac44201b19ff6fe445fb.jpg)

例如， 在流程表单中插入二维码，可以通过企业微信的扫一扫功能扫描二维码直接打开流程表单；

将构造的带云桥单点参数的链接地址，放到二维码链接里面，即可实现：

![](a054c03182b04f12fe32d815df88cb73.jpg)

# 3. **消息推送**

## **3.1消息规则配置**

消息管理功能主要是将OA应用消息推送到企业微信中，即实现在企业微信中接收并处理业务系统的消息。消息正常推送的前提是，企业微信用户要关联OA系统用户账号。

① 在【云桥】-【消息推送设置】-【消息推送规则】 页面，点击新建，如下图所示：

![](e4c542045300ff6d4eb23bb5ca1486c8.jpg)

② 例如将 日报 的消息推送到企业微信：填写好规则名称，消息来源选择日报，如下图所示：

![](d7bba2d3219e487855db7883fb2f926c.jpg)

在规则详情页面，点击【新建】，设置推送目标，第三方企业类型选择【企业微信】，企业和应用根据实际需要，选择对应的企业团队和应用，如下图所示：

![](40768af549552f8b23badca1b16e88af.jpg)

消息类型有：文字、图文、文本卡片、模板卡片，可以根据需求选择相应的消息类型，效果见3.2消息类型示例；

![](b58733f15256dcb448d14083fc2cf42f.jpg)

注意：推送目标新建之后，要点击【保存】，如下图所示：

![](0003e93b2aed692e19d729ac60600de0.jpg)

消息推送规则新建之后，可以点击【编辑】按钮，对规则详情进行编辑，如下图所示：

![](528fa8b3fc4d5f5dec68085ee5a12abe.jpg)

③ 将 日报 的消息推送到企业微信：除了第二点中所述将消息来源选择日报之外，还可以将消息来源选择为全部，如下图所示：

![](b60b89cef767340c6aa007b745c04b0d.jpg)

注意：若消息来源选择全部，OA其他应用的消息（例如审批，出勤等）也会通过这条消息推送规则推送到企业微信。

### 3.1.1 **文字**

① 消息推送规则设置，消息类型选择【文字】消息：

![](a85124986bd9fc4a5634d201cf6635a7.jpg)

① 文字消息内容默认推送消息标题，也可以根据需求自定义推送

![](7e5f60042e912da6c66fb838b47bcd8e.jpg)

![](94c44b629b50f24f239dc1f9c0c558ac.jpg)

注意：文字消息内容必填，不支持清空

![](590020160dae414d2690a37a5d0f7786.jpg)

### 3.1.2 **图文**

消息推送规则设置，消息类型选择【图文】消息：

![](1155783f74e385c060d10a14b91ec041.jpg)

云桥上传了图片：

![](229dbbffe5f1074396e31e18dcedbdcf.jpg)

云桥没有上传图片：

![](a19485f7eb6ff60cae42e0eacd5610c1.jpg)

图文消息标题必填，不支持置为空值：

![](855ab45ac0f0f356f6d72f5f4d3e85aa.jpg)

手动清空保存还是会默认带出标题：

![](abeef3cb34c4d30755c7d7445b6391c5.jpg)

图文消息内容可以根据需要选择置为空值：

![](ffde9d57aca82535954cc0318365e3af.jpg)

注意：业务模块有图片，默认优先展示业务图片；若业务模块没有图片，默认展示云桥设置的图片。

### 3.1.3 **文本卡片**

消息推送规则设置，消息类型选择【文本卡片】消息：

![](2a50f380e55d9fc1d8c177c662e7d378.jpg)

默认推送消息标题，内容和按钮：

![](1cc7b991d64738002f2f8888c28af849.jpg)

消息标题不支持置为空值，手动清空保存还是会默认带出标题：

![](5910c49f3ee2aa02eb0925d35a534a02.jpg)

内容支持置为空值：

![](a2bde6b392b96f8496cf44214c391b30.jpg)

① 按钮支持自定义【按钮文本不能超过4个字符 】：

![](6304fe40429ac48b1db59f5d4224e923.jpg)

### 3.1.4 **模板卡片**

① 消息推送规则设置，消息类型选择【模板卡片】消息：

![](17538c00e8ee47b497ba3a528fa97f85.jpg)

② 企业微信回调配置，将云桥中消息推送目标应用的回调地址填写至企业微信对应应用中：

![](677228e7366bdd15afb6b96718d98fa6.jpg)

在企业微信后台找到推送目标应用，点击【设置API接收】：

![](82f170836715aae556cc770542d7442d.jpg)

将URL、Token、EncodingAESKey复制填写到企微，保存即可：

![](72ccd9c3f1b0a6b5253e844c06dec659.jpg)

模块卡片消息示例：

消息到达：

![](78845700d931c3058111ee916d6f15c4.jpg)

审批后效果：

![](675e46c07773dc0f0ab711361e516fd2.jpg)

退回消息：

![](8c7bc02c23a6cc57930ca01d9dac0a22.jpg)

③ **注意事项：**

需要在流程工作流设置中开启【消息入口显示操作按钮】，如不开启则不会有快捷审批按钮：

![](2cee05372679e0e76957e3ae10b61b58.jpg)

需要推送模板卡片类型的消息，必须保证推送的消息是【待办】类型的 （工作流程只有 待处理流程、退回流程、抄送流程、转发流程、传阅流程、意见征询流程 这几个事件的消息支持待办， 其他的提醒反馈、催办等消息是不支持待办的），否则会推送失败。

## **3.2消息撤回**

① 可以在云桥消息推送日志里，找到对应的消息推送记录，点击撤回，即可撤回推送到企业微信的消息：

![](b174b49400e452e1c18e11cb15638f83.jpg)

② 也可以在消息中心【消息推送设置】-【推送日志】里，找到对应的消息推送记录，点击撤回：

![](7510011a9697209c89ffd8ccdb14384d.jpg)

③ 撤回示例：

![](7c920245dfc5e27d65dc0af6cd6f1490.jpg)

注意：企业微信消息仅支持撤回24小时内推送的消息。

# 4. **通讯录同步**

## **4.1前提**

云桥组织架构同步分三种：

① 将 企业微信 的组织架构同步到 云桥（不修改OA的组织架构）

![](f62a2bc4f50097c3bc64ee686f829d53.jpg)

② 将 企业微信 的组织结构同步到 云桥 同时同步到OA（修改OA的组织架构）

![](d26dae8d73c6c5eaa4226df803d4ff6c.jpg)

③ 将OA 的组织架构同步到 云桥，同时同步到 企业微信（默认在同步前会先执行“从企业微信同步组织用户绑定关系”，以保证从OA同步的时候正确比对用户和部门信息）

![](63c6ba0851e615487d3a60cb949bf530.jpg)

## **4.2同步功能相关配置**

① 执行同步前，需要已经集成过对应应用；

![](34f59c620517f4a7cd74e66b235cc10e.jpg)

② 进入【通讯录管理】，未进行过配置，在执行【从企业微信同步组织用户绑定关系】时，首先会提示配置【接口参数设置】，切换到【接口参数设置】页面，选择集成的应用，点击保存；

**注意：选择的应用，在企业微信管理后台对应应用的可见范围必须包含部门，不能只单独选择用户！！！**

**【从企业微信同步组织用户绑定关系】同步的部门和用户范围，就是所选择应用的应用可见范围！！！**

![](f97612cb2f704f05cc65f783eeb70024.jpg)

l 接口权限-只读：只能执行【从企业微信同步组织用户绑定关系】同步到云桥，不能在云桥通讯录调整数据，一切以企业号的组织架构为准；

l 选择应用：选择同步依赖的应用；

![](16cfa0a90a5e775b07b4c6433673c60b.jpg)

l 接口权限-读写：需要配置通讯录密钥（填写企业微信管理后台【管理工具】-【通讯录同步】中的Secre ），可以执行【从企业微信同步组织用户绑定关系】同步到云桥，也可以执行【同步通讯录到企业微信】；

注意：通过通讯录密钥获取企业微信通讯录部门和人员信息，需要配置企业可信IP，操作如下；

![](4a5c88f205aed6a3b7de92b4d8ca6533.jpg)

### **4.2.1 从企业微信同步组织用户绑定关系**

![](fd944469788b037be83490cb303196cf.jpg)

l 新用户关联系统：设置本次同步过来的新成员（即云桥中不存在关联关系员）是否要自动建立与OA组织架构中用户的关联关系。具体使用见4.3.1章节

l 是否定时同步：定时任务，开启可执行定时从企业微信同步组织架构。

### **4.2.2是否同步到OA**

![](6b839e6a0d9d1cb9b31c78f569983ef8.jpg)

是否同步到OA：总开关，决定是否将云桥本地的数据同步到E10组织架构，默认关闭。

具体可参考：[[#/main/cs/app/86421e44bf26440ca951b35c3ad1fa4c_baseTable?fileid=29176962&tosharerinfo=56634&tosharetype=person&_key=ttd9i8|从云桥同步到E10]]

### **4.2.3同步通讯录到企业微信**

① 基本设置

![](8dd9522aad55df406b6513636c9e6f49.jpg)

l 顶级部门：执行【同步通讯录到企业微信】，会将选择的部门以及用户，挂载到选择的顶级部门下面；

l 新用户是否添加到企业微信：设置从OA同步过来的新成员是否要调用企业微信接口自动创建到企业微信通讯录中；

l 新用户是否邀请加入：设置从OA同步过来的新成员是否要调用企业微信接口发送邀请加入该团队的信息；

l 用户所在部门是否包含兼职部门：默认只同步用户的主部门，开启后，同步范围中包含用户的兼职部门，则会同步到企业微信；

l 用户所在部门是否完全以本系统为准：

当用户在企业微信端所在的部门存在多个时：例如，用户在企业微信端在部门A、B下，而在系统端在部门C下，如果选是，同步效果就是该用户在企业微信端只在部门C下；如果选否，同步效果就是该用户在企业微信端同时在A、B、C三个部门下；

当用户在企业微信端所在的部门只有一个时：不受此配置控制，同步效果始终以系统为准；

l 离职用户处理方式：禁用表示ecology中的离职用户将在企业微信中被设置为禁用状态，即此用户将禁止使用企业微信但通讯录中还可以查询到此用户并会占有企业微信后台的用户数量；删除表示离职用户将从企业微信中删除，通讯录中不在有此用户，不占用企业微信后台的用户数，需要注意删除后此用户在企业微信中此企业下的消息记录即企业微信自身业务功能的数据也将被删除，即删除后重新添加此用户将是一条新的成员数据，历史数据都将消失，为了避免误操作，建议此处选择禁用模式；

l 禁用用户几天后删除 ：默认不填即不删除；如果配置为0天，则表示不删除；如果配置为7，则表示用户被禁用之后7天后删除；只支持正整数天后删除；可以在用户详情卡片中查看具体禁用时间；

l 禁用成员是否移动到统一部门：如果离职成员处理方式选择的是禁用，且开启了此配置，离职成员将被禁用并移动到部门名称是“已禁用用户”的部门下（默认部门名称是“已禁用用户”，用户可以根据需要自定义部门的名称）；

l 用户绑定：将OA用户和企业微信用户关联。详情见 【4.2.4 用户绑定/解绑】

l 用户字段对应关系：该配置可以将成员在EC系统的里个人信息，同步到成员在企业微信里的个人信息里；

l 对外字段对应关系：该配置可以将成员在EC系统的里个人信息，同步到成员在企业微信里的对外个人信息里；

② 范围设置

系统默认会将系统中的所有部门及用户数据同步到企业微信的通讯录中，同步范围不需要做任何设置；

如果有特殊的需要只将一部分部门及用户同步到企业微信的通讯录中，则可以设置需要同步的部门及用户范围（也可以部门和用户分开设置）；

不在此范围内的并且已经与系统建立关联关系的部门或用户将会被从企业微信中删除，并且删除操作不可逆转，所以请谨慎选择范围。

![](a899a916acb0a3bb316c6359844ed73a.jpg)

l 分部/部门范围：不选择特定分部/部门，默认为全部

l 用户范围（包含）：在此范围内的用户将被添加或者更新到企业微信

l 用户范围（排除）：在此范围内的用户不会被添加到企业微信，如果用户已关联了企业微信用户，同步后将被删除。谨慎选择

注：部门和用户可以分开设置；

用户范围（排除）的优先级高于 用户范围（包含）；

③ 安全设置和定时设置

![](966b251e347d90265d2250ea62e6ee99.jpg)

l 用户减少数量阈值：本次同步的OA用户数量和上一次相比，减少的数量超过x，将停止同步OA用户信息，x可以自己设置；

l 定时设置：设置是否开启定时自动执行同步通讯录到企业微信的操作。

### **4.2.4 用户绑定/解绑**

将OA用户和企业微信用户绑定的方式有多种：

① 手动绑定（需要配置应用）

用户完成应用集成之后，可以直接访问应用，然后输入正确的系统账号密码后，对应集成的企业微信集成-通讯录管理中会记录用户的企业微信账号信息以及绑定关系。

![](91f69a090c39e8cfbdab8964fc967cb9.jpg)

② 自动绑定设置

有两个设置的地方：一个地方配置之后，另外一处也会开启自动同步；修改任意一处，也会变更另外一处的设置。

l 从企业微信同步组织用户绑定关系-->新用户关联系统账号（使用见4.3.1）

l 同步通讯录到企业微信-->用户绑定（使用见4.3.2）

注意：若任意一处开启了关联设置，此时用户访问应用，也可通过关联设置自动关联；

![](9d01f184a8741a7c2fb596017cf94704.jpg)

③ 关联导入

![](bfed3aba1113434efe010803ce1dfaf8.jpg)

将已经同步到云桥本地的数据导出，并且将需要绑定的OA用户的对应字段写入到文档关联字段那一列，上传文档，点击导入按钮，即可将关联关系写入。

例如：企业微信用户B要绑定OA用户的B1，选择的关联字段是【手机号】，在导出的B这一栏的关联字段中，填写B1的手机号，保存后将文件再导入，并且关联字段选择【手机号】，然后点击导入按钮即可。

![](4f039cf038cffc66bfec40adf09ef1cd.jpg)

④ 用户卡片绑定/解绑

![](45990bec330827edf2a23cc61274b485.jpg)

⑤ 批量解绑

解除云桥本地所有用户和OA用户的关联关系；

![](b2bc38028b1a2fc5fcbfb51634ba6ed7.jpg)

## **4.3同步功能使用说明**

云桥主要是将企业微信和OA的组织架构关联起来，所以同步前需要确认组织架构以企业微信端为准，还是以OA端为准！

### **4.3.1 以企业微信组织架构为准**

首先执行【从企业微信同步组织用户绑定关系】，然后把用户在企业微信中的身份和在OA系统中的身份关联上，使用如下任何一种方式：

方法一：手动关联（见4.2.4）。

方法二：在 从企业微信同步时进行自动关联：需要在【从企业微信同步组织用户绑定关系】时，开启【新用户关联系统账号】，配置关联字段之后，进行同步。

例如：用户在 企业微信的身份 和OA身份 使用 企业微信账号 匹配OA系统工号 进行关联。

![](657cdd546a4868461c996dc2ee910ae7.jpg)

后续可以在 【从企业微信同步组织用户绑定关系】时，开启定时同步，每隔一段时间将企业微信的组织架构的变动更新到云桥。

![](dbd57aa3816d4e1908c0448fbb72506f.jpg)

如果不希望在OA修改组织架构或者在云桥菜单中修改后影响到企业微信的组织架构，可以开启通讯录的只读模式：只允许企业微信的修改同步到云桥本地。

![](baaedf54cf9546e9cb99ce43cb82cded.jpg)

是否同步到OA可以参考章节4.2.2；

### **4.3.2 以OA组织架构为准**

分为两种情况：

#### **4.3.2.1 企业微信没有组织架构**

（默认已经执行过从企业微信同步组织用户绑定关系）

① 无需进行用户账号绑定。

② 执行【同步通讯录到企业微信】，执行完成后，云桥会把OA的用户创建到企业微信，并且自动把用户在企业微信中的身份和在OA系统中的身份关联上。在创建企业微信用户时，企业微信用户的账号使用的是OA用户如下配置字段的值：

![](23ce931560c00c4e14c0d51b42aab049.jpg)

#### **4.3.2.2 企业微信有组织架构**

（默认已经执行过从企业微信同步组织用户绑定关系）

① 设置企业微信历史用户（即企业微信已存在的用户）账号绑定，选择如下任意一种方式进行关联：

方法一：手动关联（见4.2.4）

方法二：自动关联，在第二步执行同步的时候配置用户匹配字段。

![](702762e04dcac8dcd692f2d7ebf0ae77.jpg)

注：如果自动绑定无法满足将企业微信用户和OA用户关联，可以在从OA同步前先使用手动绑定关联这些用户。

② 设置顶级部门

是否设置顶级部门决定了同步后的组织架构；

部门关联的逻辑是：层级相同且部门名称相同，在执行同步的时候，会自动关联，否则，在云桥和企业微信新建部门。关联上的部门前面会有一个黑色实心原点，代表已关联；

举例说明：分为两种情况，没有设置顶级部门和设置了顶级部门；

l 没有设置顶级部门，默认同步OA整体组织架构

![](8635749e79f55c2d69740a43ccba7d7b.jpg)

如下图所示，根据层级和名称首先进行顶级部门匹配，则OA顶级部门【演示部门】去匹配云桥顶级部门【演示部门】，可以匹配。一级部门能够匹配上的只有【部门A】，则其他没有匹配上的部门，会在云桥和企业微信新建。

![](89e25dc2e81283c2be0235d8b33ca559.jpg)

同步后效果（可以先同步模拟同步查看效果）：橘色为匹配，紫色为新增；

![](c3b13af9aac8edb01f77e58bd8f9daaa.jpg)

注：如果顶级部门的名称不相同，例如【Re部门】和【演示部门】名称不同，则顶级部门无法匹配，同步立刻中止。

![](659c40f99fe0a2f1d60158b489da3d18.jpg)

提示如下：

![](58b4159b1f07d9cbed51dd3560d77550.jpg)

l 设置了顶级部门，默认同步OA整体组织架构。选定【其他部门】为此次同步的顶级部门：

![](92e9c6c3d97c3f1e0e92a269fb92619d.jpg)

如图所示，组织架构层级对应如下：

![](2a96bed7dcff2735d111a15cc8a8aba6.jpg)

执行同步，会将OA【Re部门】及其下级部门，同步到云桥【其他部门】下，作为顶级部门。

根据部门匹配的原则，OA一级部门【Re部门】和顶级部门下的一级部门没有名称相同的，直接新建。

同步效果如图：

![](67f49a38c64b438e4432526249e603fd.jpg)

### **4.3.3 其他注意事项**

① 当企业微信的组织架构发生变化之后，需要在执行【同步通讯录到企业微信】之前，先执行【从企业微信同步组织结构绑定关系】。

② 如果该企业微信用户已经关联OA的账号，那么从OA同步的时候，用户匹配字段的配置将不会修改原有的绑定关系，该配置只针对未关联OA的企业微信用户。

③ 接口参数设置，如果设置了只读权限，所有在云桥对组织架构进行的操作（不包括用户手动关联用户），都不能操作。

# 5. **考勤同步**

# ① 请登录企业微信管理后台https://work.weixin.qq.com/wework\_admin/loginpage\_wx?from=myhome，找到应用管理里面的打卡应用，获取打卡应用的agentid和Secret；（若没有agentid和Secret，按照下述另外一种方式配置）

![](97dd51c53dba6dc7c27bb944da6b319c.jpg)

② 在云桥配置企业微信打卡应用的agentid和Secret，点击保存；

![](1010ce586fe0fdd63f9306e941e0f1b3.jpg)

**注意：**从2023年12月1日0点起，企业微信不再支持通过系统打卡应用secret调用接口，存量企业暂不受影响https://developer.work.weixin.qq.com/document/51165，受影响的企业可以按照如下配置：**

l 第一步、点击设置，选择一个自建应用；

![](27361569b31217722bf60e6f87af578e.jpg)

![](51ba7bcab5dd1cfae7073abb858bfa5b.jpg)

l 第二步、复制自建应用的agentid和Secret；

![](301fb51b6d736aa71d46fec784a80aaa.jpg)

l 第三步、将复制的自建应用的agentid和Secret配置到云桥-企业微信-考勤同步中，点击保存；

![](d335276f5b7ff2714e0f306a87ceebdc.jpg)

③ 手动执行同步：

![](49638cd3364f69bc1b8cdf6cc119ad74.jpg)

④ 定时同步：新建定时规则

![](ca336655cfb3c2c878e81e168dc76fca.jpg)

# 6. **扫码登录**

此功能主要实现通过企业微信自带的扫一扫功能扫描OA系统首页的二维码进行登录OA系统，具体位置如下图：

![](3acbfaa3a77734f50612ea40b0f8ccb5.jpg)

如果在未集成企业微信和应用的情况下，直接点击后面的【设置】按钮，会提示“请先添加企业微信”，故配置扫码登录功能前，请先集成企业微信和应用，参考手册第1、2点【1.企业集成、2.应用集成】。

① 点击扫码登录功能后面的【设置】按钮，进入配置页面，先点击开启按钮，再选择集成的应用后保存，如下图所示：

![](25a95ce0a3f219e4ced48e4ab91e1b4f.jpg)

② 打开OA系统登录首页，扫码入口在右上角，如下图所示：

![](b9378bc6e29cbe3b371b0b1b0f593ea6.jpg)

③ 使用手机端企业微信自带的扫一扫功能，扫OA系统登录首页二维码，如下图所示：

![](a1010c77c40af2e7574a49736e4fa97e.jpg)

④ 扫完之后，需要选择租户（也就是团队名称）及集成的企业名称，如下图所示：

![](e81544e6f141470f4cdf85de42ea480c.jpg)

⑤ 选择完企业之后，如果人员在集成企业的通讯录里无关联关系且未开启自动关联（如下图1），则会出现此界面（如下图2）：

![](c2937aabe285396493a5ff855eeadd52.jpg)

![](25d4e42fd4cffb365f7027d9d0f3f5d7.jpg)

⑥ 需要人员建立了关联关系后才可正常登录oa系统，具体建立关联的操作方法可参考此文档【4.2.4用户绑定/解绑】中的①手动绑定②自动绑定设置（开启了关联设置，此时用户访问应用，也可通过关联设置自动关联）④用户卡片绑定；扫码选择完企业后，若建立了关联关系，就能正常登录oa系统页面，效果如下图所示：

![](4f7a8e8a7a6f1e15f726bf3be6642d2d.jpg)

# 7. **客户管理**

功能入口：

![](8ab6628c89536859243de24e05b52c15.jpg)

## **7.1功能配置**

① 接口设置：接口调用模式可以选择 使用客户联系秘钥 或者 使用企业微信应用秘钥；

![](a55bf2d39c11d3cc48a2fc5f3aa8d4ae.jpg)

l 客户联系秘钥：

第一步：请登录企业微信管理后台https://work.weixin.qq.com/wework\_admin/frame#customer/analysis，【客户与上下游】-【客户】中查看secret；

![](c34a6a023a0de767743161814d1da07a.jpg)

第二步： 点击客户管理，选择接口调用模式-使用客户联系秘钥；

![](c9c92803b11a6bcfdf8d54c97448c683.jpg)

l 企业微信应用密钥：

第一步：企业微信管理后台给用户使用外部联系人的权限；

![](02ead0c1a072f0f676466fd7284946ed.jpg)

第二步：新建一个应用在云桥里集成（使用之前的应用也可以），具体参考该文档第2点【应用集成】；

第三步：给该应用授权获取外部联系人的权限，勾选应用后面的方框，点击保存；

![](d3f0335a09a1c4457eed583906ac1edc.jpg)

![](a74c6e0878ab0ede4f7293896e0e05ba.jpg)

第四步：点击客户管理，选择接口调用模式-使用企业微信应用秘钥；

![](fd98903607bc8a83c4040a84587b5a1f.jpg)

## **7.2外部联系人列表**

### **7.2.1外部联系人手动同步**

① 选择 使用客户联系密钥 ，点击外部联系人列表，点击同步，能获取到企业里 所有人的外部联系人 ；

![](89d35be721b7185b16dfc8bff9cf2fed.jpg)

l 企业微信用户A有关联OA账号A1，外部联系人能同步到关联的OA账号A1的【通讯录】-【外部互联】里；

例如企业微信用户岳梦娇关联了OA用户岳梦娇：

![](5fe5e4c9f9f3c57a40fe5e902f9a7215.jpg)

在OA用户岳梦娇的账号【通讯录】-【外部互联】里面可以看到同步过来的外部联系人：

![](a3d941c8621c03c4503d61bf282ec2ea.jpg)

在外部联系人列表里面就显示为已关联：

![](c987aeb9cc9cf592db93c54b7d5470f6.jpg)

l 企业微信用户A无关联关系，外部联系人不能同步到【通讯录】-【外部互联】里，即在外部联系人列表里面的外部联系人是无关联状态。

② 选择 使用企业微信应用密钥 ，点击外部联系人列表，点击同步，能获取到应用可见范围内有 外部联系人使用权限的人员的外部联系人；

l 企业微信用户A有关联OA账号A1，外部联系人能同步到关联的OA账号A1的【通讯录】-【外部互联】里；

l 企业微信用户A无关联关系，外部联系人不能同步到【通讯录】-【外部互联】里，即在外部联系人列表里面的外部联系人是无关联状态。

注：以上提到的同步的外部联系人都需要给内部用户开启使用外部联系人权限。

### **7.2.2外部联系人自动同步**

① 接口调用模式选择 使用客户联系密钥：

复制图中回调相关参数：

![](9896821bb8c6ff1dc7b2cf476dea6b03.jpg)

将复制的参数配置到企业管理后台-【客户与上下游】-【客户】-【接收事件服务器】中：

![](802dcad110bc90f84e27ac4f099619c6.jpg)

![](01878db710201b83559a2ef4c5577b00.jpg)

之后新增的外部联系人就能自动同步到外部联系人列表里，企业微信用户A有关联OA账号A1，外部联系人能同时同步到关联的OA账号A1的【通讯录】-【外部互联】里（企业微信用户A无关联关系，外部联系人不能同步到【通讯录】-【外部互联】里，即在外部联系人列表里面的外部联系人是无关联状态）。

② 接口调用模式选择 使用企业微信应用密钥：

首先，分别在 云桥 和 企业微信后台 找到选择的应用，

![](a3e6b7ee7749825454b072481ad3ab60.jpg)

![](6a202040536dcf2c7095ca58cfde9f06.jpg)

![](f0debe1cb319627a8b0cf249406dd886.jpg)

然后点击接收消息：

![](ce9b310b18f87d978ff0e3ce3ff778e4.jpg)

分别复制回调url、Token、EncodingAESKey到企业微信后台对应的应用-【接收消息】中，点击保存：

![](fcd6c2e4703f268811b67b0cbea874f6.jpg)

![](405dfbef44f9dd57dbe12789547b8b11.jpg)

之后新增的外部联系人就能自动同步到外部联系人列表里，企业微信用户A有关联OA账号A1，外部联系人能同时同步到关联的OA账号A1的【通讯录】-【外部互联】里（企业微信用户A无关联关系，外部联系人不能同步到【通讯录】-【外部互联】里，即在外部联系人列表里面的外部联系人是无关联状态）。

具体的功能使用说明可参考：[[#/main/cs/app/86421e44bf26440ca951b35c3ad1fa4c_baseTable?fileid=32438830&tosharerinfo=245393&tosharetype=person&_key=b4zxzs|私有环境外部联系人]]

# 8. **消息存档**

使用前提：需要购买企业微信会话内容存档功能或者申请试用体验，具体可以咨询企业微信。

① 请登录企业微信管理后台https://work.weixin.qq.com/wework\_admin/frame#manageTools，找到【管理工具】里面的【会话内容存档】 ，查看 Secret：

![](aca96cb2ccab29bd3d86195c41586a74.jpg)

② 访问云桥-【企业微信集成】-【消息存档】，点击【设置】配置消息存档同步Secret：

![](d704295c545ed0479e3de2f416c99e0b.jpg)

③ 依赖的应用需要选择具有消息存档权限的应用，具体的应用集成可以参考【2.应用集成】；

# 9. **其他功能说明**

## **9.1**[[#/question/d8409a3d4453479bbb91749c0dd51c64|企业微信-聊天附件栏+工具栏配置]]

① 功能入口如图：

![](dfe9ad86f7bb3a14888506e82cb8025f.jpg)

② 功能配置可参考：https://yq.weaver.com.cn/eb/qa/view/#/question/d8409a3d4453479bbb91749c0dd51c64

## **9.2更多设置**

① 功能入口：

![](1b29019c1e292660ea997f2b46313fd5.jpg)

② 功能说明：

目前在企业微信应用中，点击右上角更多打开的菜单包括传播类（转发、微信、收藏）、基本类（调整字体、刷新）以及保护类（复制链接、Safari、邮件），可以通过该功能进行控制显示哪些菜单项；

③ 功能示例：以下说明都是已IOS为例；

l 【隐藏所有非基础功能按钮】，点击隐藏所有非基础功能按钮之后，手机端只会展示基础功能的按钮，如下图：

![](0c5edb871e8bc793d05d248471abd677.jpg)

l 【分享到同事吧】和【分享到朋友圈】暂不支持单独隐藏，即按钮是置灰的，不支持选中，但是可以通过【隐藏所有非基础功能按钮】来隐藏 ；

l 【发消息】和【消息通知】不支持隐藏，即按钮是置灰的，不支持选中，无法通过【隐藏所有非基础功能按钮】来隐藏 ；

l 【隐藏所有非基础功能按钮】之后，再点击其他的按钮，无法启用对应的按钮（此种情况禁止单独启用按钮，必须先点击【展示所有非基础功能按钮】）

![](d6cf51afdc16400791873a0498e833b5.jpg)

l 默认展示所有功能按钮，在没有点击【隐藏所有非基础功能按钮】的情况下，所有的蓝色按钮都支持单独选中，控制此菜单项是否展示；

![](81c5ba3099ed84e2660b416e978a6e66.jpg)

## **9.3回调设置**

① 功能入口：

![](9ee908d70f7868d0f2610610cdc8c23d.jpg)

② 功能说明：企业微信需要实现针对企业微信不同动作的回调自动回复不同的内容，比如用户在企业微信应用会话中输入的内容，我们可以根据用户的动作来设置回复不同的内容给用户。

③ 功能配置：

l 首先，在云桥找到需要接收回调消息的应用，复制【接收消息】页面的参数：

![](1e8676a81c35759c28b0c1a511009754.jpg)

l 在企业微信管理后台-【应用管理】，找到需要接收回调消息的应用，设置API接收：

![](499d8d6dad494d6a972ee735df221f20.jpg)

l 将云桥复制的参数填写到对应位置，点击保存：

![](0fbae519a9dcb74f38f04b6d90e467df.jpg)

l 开启云桥-应用详情-接收消息里面的【是否开启应用回调】开关：

![](4c901ab65bb68e280a0d529698f1a284.jpg)

④ 回调规则设置：

l 回调设置新建具体的消息回复规则：

![](dfb05a20762cb48a0ef9571a0fae3246.jpg)

l 规则名称：填写该条规则的名称；

l 用户动作：指用户给企业微信应用发送的是文字消息还是图片消息；

l 匹配方式：

【包含】用户给企业微信应用发送文字内容包含设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【开头】用户给企业微信应用发送文字内容的开头文字是设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【结束】用户给企业微信应用发送文字内容的末尾文字是设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【完全匹配】用户给企业微信应用发送文字内容等于设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【直接托管】用户给企业微信应用发送文字消息，无论发送什么文字内容，都给予同样的回复；

l 关键字：通过关键字和用户发送的文字消息进行比对，匹配对应的规则，按照该规则自动给用户回复；关键字字数限制50个字符；

**注意：只有当用户动作是【发送文字】，才有匹配方式和关键字！**

l 回复内容：用户给企业微信应用发消息，匹配上该条规则后，可以在回复内容里面设置自动给用户发送的内容；回复内容字数限制1500个字符；

l 优先级：优先级数字越小，表示优先级越高，系统会优先执行优先级高的规则，最小值为1，最大值为100，不支持小数

l 启用：启用或者关闭当前规则

l 删除/批量删除：

![](97053c908c160cae4cbbaaa14e4d92a6.jpg)

⑤ 功能演示：

l 用户发送的文字消息，包含关键字：

![](b73986200fc6022e2a835e0f3784a87d.jpg)

![](82b24e6f3a50d2e5756cbd6a07e8d8e7.jpg)

l 用户发送的文字消息，开头是关键字：

![](3fcdb8916e4a75edae2967d90653e261.jpg)

![](836bd1faecc6cc80f29e41f7aa233177.jpg)

l 用户发送的文字消息，结尾是关键字：

![](7b6529a3571efb0d6599f881cc9fb7f4.jpg)

![](fe4c86cc130e6c7e01c8b892a070f868.jpg)

l 用户发送的文字消息，等于关键字：

![](bb671d4ed07ab98d7bb7eb9ac9c30c66.jpg)

![](ec342b394480aca37fd5cbaeb9221098.jpg)

l 用户发送的文字消息，无论发送什么文字内容，都给予同样的回复：

![](46d8b7db9605a56fff61df9db3124fcd.jpg)

![](74c9d7c093747d5ef24d61cf341277d9.jpg)

l 用户发送的图片消息：

![](35d62402cacf32bca91f14e8e4cf7dcb.jpg)

![](cda98f4de4c5451626e9c98c31e8f179.jpg)

⑥ 其他说明：

l 自动回复支持换行符

![](dbea0281698b68d2f45041cb695e6bfd.jpg)

![](0c08051af8513a7b63560d3b3078866f.jpg)

l 自动回复支持超链接

![](0253552baaf803240cf5da0f0fd28aa8.jpg)

![](695b56e59ec58ba3640afdd818c3554b.jpg)

## **9.4查看企微域名对应的ip清单**

① 功能入口

![](258d01edf3c2c96329fe037b10154ad0.jpg)

② 功能说明：

有的客户不开放所有的IP，只开放个别，但是企业微信偶尔又会下线一些IP，这样就会导致这些开放个别IP的客户，可能正好用到的就是被下线的IP，就导致无法使用，通过企业微信提供的接口获取到企业微信接口IP清单，在小提示中点击【点击此处】即可查看，便于客户自行调整。

注：查看ip清单需要开通云桥服务器访问https://weapp.eteams.cn的网络权限。