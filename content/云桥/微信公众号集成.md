---
aliases: ["1968914883702741011"]
title: 微信公众号集成
created: 2025-07-15
modified: 2025-07-15
tags: ['云桥']
theme: 云桥
---

**一、概述**

支持与微信公众号集成，包括“人员绑定”“应用集成到公众号"”消息互通“，即实现在公众号上使用我们的应用，包括推送消息。

二**、操作说明**

[[#集成配置|1. 集成配置]]

[[#云桥新建公众号|1.1 新建公众号]]

[[#填写微信公众号相关信息|1.2 填写微信公众号相关信息]]

[[#配置IP白名单|1.3 配置IP白名单]]

[[#配置回调设置|1.4 配置回调设置]]

[[#网页授权域名设置|1.5 网页授权域名设置]]

[[#JS接口安全域名设置|2. JS接口安全域名设置]]

[[#粉丝列表|3. 粉丝列表]]

[[#菜单管理|4. 菜单管理]]

[[#链接管理|5. 链接管理]]

[[#消息推送|6. 消息推送]]

[[#消息推送规则配置|6.1 消息推送规则配置]]

[[#模板消息|6.1.1 模板消息]]

[6.1.2 订阅通知](http://订阅通知)

[[#回调配置|7. 回调配置]]

**【云桥对外域名】配置说明**

集成企业微信需要配置外网域名地址，在【云桥】-【基础参数设置】配置当前系统的外网域名地址，配置好之后点击保存，如下图所示：

![](ce6069f3705d3195d477d2b9a8f71b91.jpg)

**【开通服务器网络权限的说明】**

1.如果使用本系统进行公众号集成功能，则需要调用公众号接口，并且最终用户是通过公众号来使用集成的功能，所以本系统部署的云桥服务器必须要求，能够访问外网：即开通这台服务器的上网权限，让云桥服务器能够访问互联网，如果贵公司对网络安全要求较高，至少需要让这个服务器能够访问以下地址：  
微信公众号API：https://api.weixin.qq.com  

2.同时请网络管理员将本系统的访问地址映射到外网。  

3.可以用如下方式验证网络是否通畅：  
在云桥服务器上按如下方式检查网络：  
ping api.weixin.qq.com 查看是否能ping通  
Window:  
浏览器访问 https://api.weixin.qq.com/cgi-bin/token 查看是否有返回结果  
Linux:  
执行命令 curl https://api.weixin.qq.com/cgi-bin/token 查看是否有返回结果

# 1. **集成配置**

微信公众号接入功能主要是在云桥中建立微信公众号接入信息，将基本的公众号原始ID等信息写入到云桥中。

## **1.1 云桥新建公众号**

点击后台管理中心，在所有服务中选择云桥或者平台引擎里点击云桥，即可进入云桥页面，访问【微信公众号集成】菜单，点击右上角【新建微信公众号】，如下图所示：

![](34bc440127c3c3627d460a411b3d9fc9.jpg)

## **1.2 填写微信公众号相关信息**

![](46f6dd0f098726829e43829c958ffa8d.jpg)

公众号名称：根据需要填写微信公众号的名称；

公众号原始ID：填写微信公众平台左侧菜单【设置与开发】-【公众号设置】中的原始ID，访问微信公众平台https://mp.weixin.qq.com，即可查看；

![](1af88623da221aec2895cc6c630d0678.jpg)

公众号类型：选择公众号为服务号或订阅号，服务号有获取用户身份的功能，订阅号则没有，所以一般集成都需要是服务号类型；

是否认证：填写公众号是否经过认证，具体访问微信公众平台https://mp.weixin.qq.com查看；

![](da9119497542bca1ac2b1eef601c6ef9.jpg)

二维码图片：上传此公众号的二维码图片，可以从微信公众平台左侧菜单【公众号设置】中获取，如下图所示：

![](759135e6e17d5018b57d0852d888afa4.jpg)

AppID、AppSecret：在微信公众平台https://mp.weixin.qq.com页面中点击左侧菜单【设置与开发】-【基本配置】，即可获取AppID、AppSecret，如下图所示：

![](63ceacc74062aa350d9119cb2379028e.jpg)

备注：填写对公众号的描述信息；

## **1.3配置IP白名单**

在微信公众平台页面中点击左侧菜单【设置与开发】-【基本配置】，将当前系统的外网IP配置到IP白名单中，如下图：

![](a756439e7a4efb297a196d8aa37ec63c.jpg)

## **1.4 配置回调设置**

在微信公众平台页面中点击左侧菜单【设置与开发】-【基本配置】，点击【启用】开启服务器配置，如下图：

![](76650c6355c8d5360ae87febcfc41b89.jpg)

点击【修改配置】，进入服务器配置页面，如下图：

![](c15b0f793b7722b58c2566504a219782.jpg)

其中页面上的URL、Token、EncodingAESKey三个值从云桥-微信公众号集成-接收消息中复制即可，消息加密方式推荐使用【安全模式】，填写好之后点击提交；

![](6ea66ea52c4007a6331c91beed44cb58.jpg)

## **1.5 网页授权域名设置**

在微信公众平台页面中点击左侧菜单【设置与开发】-【公众号设置】，找到【网页授权域名】，点击【设置】，如下图：

![](2058ca77ad7c70293a9afcad311dc1a8.jpg)

将云桥-微信公众号集成-回调设置中的可信域名填写到网页授权域名中（订阅号忽略此步骤），填写之后点击保存；

![](a1348e43a3c49047f701c6dffe0ec44f.jpg)

填写之后，下载界面上的txt文件，上传到【云桥】-【微信公众号集成】-【可信域名验证】中：

![](de8e1a94552186bf70b6c32be7ff1087.jpg)

域名校验文件上传之后，点击保存：

![](5884baa9dad672a7befb8011321089a9.jpg)

需要注意，可信域名不能带有端口号，即云桥的外网地址必须确保是经过ICP备案的域名并且是标准接口（80或443）；

# 2. **JS接口安全域名设置**

如果公众号集成后需要使用到EC系统中的考勤定位，扫码登录等功能，则需要调用公众号的jsapi方法进行实现，调用的前提是设置js接口安全域名，如果不需要使用到此类功能则可以忽略此步操作；

在【云桥】-【微信公众号集成】-【可信域名验证】中复制可信域名：

![](6de65123d5488801bad8fd9b1e76b01f.jpg)

将复制的可信域名填写到JS接口安全域名中：在微信公众平台页面中点击左侧菜单【设置与开发】-【公众号设置】-【功能设置】，找到【JS接口安全域名】，点击【设置】，如下图：

![](95e6c9f38eb7e187cbe308c185f10974.jpg)

填写之后，下载界面上的txt文件，上传到【云桥】-【微信公众号集成】-【可信域名验证】中：

![](d7d62397a53ff9c88b4e1d800b8795f9.jpg)

域名校验文件上传之后，点击保存：

![](df8033ca14829372f4765d9e8fc3469d.jpg)

需要注意，可信域名不能带有端口号，即云桥的外网地址必须确保是经过ICP备案的域名并且是标准接口（80或443）；

# 3. **粉丝列表**

粉丝管理功能主要是在云桥中管理微信公众号的粉丝数据，将粉丝人员与ecology系统中的人员进行关联；访问【云桥】-【微信公众号集成】-【粉丝列表】，点击同步，即可将公众号的粉丝用户同步到云桥：

![](954e2910005fceda90307d78218e21e0.jpg)

从公众号同步操作完成之后，会显示同步的结果，也可以再次进行从公众号同步操作，并且可以对已同步的数据进行维护操作。用户卡片绑定/解绑，如下图所示：

![](84c607c529a924b0b68aa27463be7328.jpg)

手动绑定（需要配置公众号菜单）

用户完成公众号菜单配置之后，可以直接访问菜单，然后输入正确的系统账号密码后，对应集成的微信公众号集成-粉丝列表中会记录用户的企业微信账号信息以及绑定关系。

![](a7dfc00c8642b99635b6e8bf95539167.jpg)

# 4. **菜单管理**

菜单管理功能主要是在云桥中将公众号菜单与业务系统（ecology）功能模块进行对接，即实现在微信公众号中使用业务系统的相关业务功能。

进入【云桥】-【微信公众号集成】-【菜单管理】页面，如下图：

![](a0f70bc705988e881bd21ef60a40ca73.jpg)

这个页面中可以增加菜单，将ecology系统的模块配置到公众号的菜单中，例如将ecology的工作日报发布到公众号中，调用模块选择打开应用，可以直接选择打开应用【工作日报】，如下图：

![](abe2bdca05756d2e846660023e3e0261.jpg)

也可以根据需求选择定义的链接：

![](94c63705a1f96f412256918e6be0ba33.jpg)

# 5. **链接管理**

链接管理功能和菜单管理类似，可以选择配置EC系统的业务功能，也可以直接配置自定义链接的功能，新建好链接管理：

![](bf90a9793fab74c96bf739db8625219f.jpg)

复制对应的链接，可以直接配置到公众号开发后台的公众号菜单中，如下图：

![](e925763404e30721cb2b820fafdf4bdc.jpg)

# 6. **消息推送**

消息管理功能主要是将OA应用消息推送到微信公众号中，即实现在微信公众号中接收并处理业务系统的消息。消息正常推送的前提是，微信公众号用户要关联OA系统用户账号。

## **6.1消息推送规则配置**

① 在【云桥】-【消息推送设置】-【消息推送规则】 页面，点击新建，如下图所示：

![](10010771f3511f9e163a8f67d27d27d7.jpg)

② 例如将 日报 的消息推送到微信公众号：填写好规则名称，消息来源选择日报，如下图所示：

![](1746b85c85434ee18d1bd79b0f0fd510.jpg)

在规则详情页面，点击【新建】，设置推送目标，第三方企业类型选择【微信公众号】，企业和应用根据实际需要，选择对应的企业团队和应用，如下图所示：

![](235c74d50f8e24cf2b1290ca8283f2f7.jpg)

模板ID获取方式：访问微信公众平台https://mp.weixin.qq.com，在【广告与服务】-【模板消息】中新建模板或者使用之前的模板ID；

![](1f89a5a908614b33380d1030b07c0c23.jpg)

**6.1.1 模板消息**

① 消息推送规则设置，消息类型选择【模板消息】；

![](c9def91416e8f2291e529d16e1b4480c.jpg)

① 模板ID获取方式：访问微信公众平台https://mp.weixin.qq.com，在【广告与服务】-【模板消息】中新建模板或者使用之前的模板ID；

![](897f5a44b84813a87a31a7d17112924e.jpg)

① 将模板参数配置到云桥，配置完成后点击【保存】；

![](8d20f24eb07ea3a68ee8f51cd4619eed.jpg)

① 推送效果如下；

![](f8a155d18504f18cc08b8aba20dd452f.jpg)

**6.1.2 订阅通知**

需要参考微信公众号订阅通知说明文档[https://developers.weixin.qq.com/doc/offiaccount/Subscription\_Messages/intro.html，](https://developers.weixin.qq.com/doc/offiaccount/Subscription_Messages/intro.html，完成步骤一到步骤五的配置工作，才能进行后续操作； )完成步骤一到步骤五的配置工作，才能进行后续操作；

消息推送规则设置，消息类型选择【订阅通知】；

![](cb268cdb26b3990dd008798b7fc36b9d.jpg)

① 模板ID获取方式：访问微信公众平台https://mp.weixin.qq.com，在【广告与服务】-【订阅通知】中新建模板或者使用之前的模板ID；

![](3cd77025e2d41de5418e6ce03d92e3da.jpg)

① 将模板参数配置到云桥，配置完成后点击【保存】；

##

##

① 推送效果如下；

l 电脑端

![](07ecccf6d17e6c78fd1cc9512d4883af.jpg)

l 手机端

##

##

是否带链接：

##

![](b64a399654ec444934a91d33e19a8450.jpg)

① 消息推送报错常见错误码查询入口https://developers.weixin.qq.com/doc/offiaccount/Subscription\_Messages/api.html；

例如：

##

**![](c605002c34a7136e545e015726b58d35.jpg)**

此类情况需要用户主动订阅通知，可参考

<https://developers.weixin.qq.com/doc/offiaccount/Subscription_Messages/intro.html>

![](4276560784e37b7a434e537ef842f1e2.jpg)

# 7. **回调设置**

① 功能入口：

![](a56eedd5d4ac6fcd9145a0ce2a7ed3b4.jpg)

② 功能说明：微信公众号需要实现针对微信公众号不同动作的回调自动回复不同的内容，比如用户在微信公众号应用会话中输入的内容，我们可以根据用户的动作来设置回复不同的内容给用户。

③ 功能配置：

l首先，在云桥找到需要接收回调消息的公众号，复制【接收消息】页面的参数：

![](2b84ccd48708f3ebb1bdfba45907b337.jpg)

l在微信公众平台页面中点击左侧菜单【设置与开发】-【基本配置】，点击【启用】开启服务器配置，如下图：

![](142b3a1b181accb5e0a5bc5f93b38455.jpg)

点击【修改配置】，进入服务器配置页面，将云桥复制的参数填写到对应位置，点击保存，如下图：

![](6f315389ec08222db9f69decdab9e604.jpg)

l开启云桥-微信公众号-接收消息里面的【是否开启应用回调】开关：

![](5f0ff048f6a0108424610343224d5a59.jpg)

④ 回调规则设置：

l回调设置新建具体的消息回复规则：

![](0d94215fd0305f74c7d9243dc577cb4f.jpg)

l规则名称：填写该条规则的名称；

l用户动作：指用户给微信公众号应用发送的是文字消息还是图片消息；

l匹配方式：

【包含】用户给微信公众号应用发送文字内容包含设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【开头】用户给微信公众号应用发送文字内容的开头文字是设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【结束】用户给微信公众号应用发送文字内容的末尾文字是设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【完全匹配】用户给微信公众号应用发送文字内容等于设置的关键字，则匹配上该规则，按照该规则自动给用户回复；

【直接托管】用户给微信公众号应用发送文字消息，无论发送什么文字内容，都给予同样的回复；

l关键字：通过关键字和用户发送的文字消息进行比对，匹配对应的规则，按照该规则自动给用户回复；关键字字数限制50个字符；

**注意：只有当用户动作是【发送文字】，才有匹配方式和关键字！**

l回复内容：用户给微信公众号应用发消息，匹配上该条规则后，可以在回复内容里面设置自动给用户发送的内容；回复内容字数限制1500个字符；

l优先级：优先级数字越小，表示优先级越高，系统会优先执行优先级高的规则，最小值为1，最大值为100，不支持小数

l启用：启用或者关闭当前规则

l删除/批量删除：

![](76dd403c06c958013dd408f8e7ee1b5b.jpg)

⑤ 功能演示：

l用户发送的文字消息，包含关键字：

![](d66d86a524d0974ad7b703ffb6caa2ee.jpg)

![](570dbc761f60567a37071ff04b6b8709.jpg)

l用户发送的文字消息，开头是关键字：

![](502c87ed6a01924597885c5168e2ccc9.jpg)

![](eab20890d15f8244c50dcd446b03c37d.jpg)

l用户发送的文字消息，结尾是关键字：

![](c671812950428d896e16e58ab1465991.jpg)

![](10657a67d002576c4b3639129603b0c5.jpg)

l用户发送的文字消息，等于关键字：

![](5e398bfc61e1cf4fab65e476c2a2e289.jpg)

![](b0bbce0896fd06a76d516098e1a983b4.jpg)

l用户发送的文字消息，无论发送什么文字内容，都给予同样的回复：

![](862b8c7d8e6463d8eb0d90845f3b6f03.jpg)

![](e346c58fac46912560eb3c9204d50be8.jpg)

l用户发送的图片消息：

![](8d1b997dd9f85df48add3ba731317744.jpg)

![](aed2e83c842ba6fe975ad1ee72237ee7.jpg)

⑥ 其他说明：

l自动回复支持换行符\n

![](bb664c972ae18f640ffd04c92a2575fe.jpg)

![](1e5b1b96eb085590e346b1cd789bfcc3.jpg)

l自动回复支持超链接

![](a7d51861fa4aab1d8a17880f14a3dcd2.jpg)

![](04a7fd3a637438a88afbc8f2ae4b6953.jpg)