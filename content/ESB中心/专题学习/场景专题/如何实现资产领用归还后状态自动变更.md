---
aliases: ["1969529083568543943"]
title: 如何实现资产领用/归还后状态自动变更
created: 2025-07-15
modified: 2025-07-15
tags: ['ESB中心']
theme: ESB中心
---

**1.** **场景说明**

资产管理是企业管理的一项基本功，也是企业实现可持续发展的关键之一。通过科学合理的资产管理，企业可以优化资源配置，提高经济效益，增强企业的竞争力，实现可持续发展。在资产管理过程中，资产的领用/归还是极其重要的一环，如何精确掌握资产动向，自动化变更资产状态，对于资产的管理者与使用者来说都是尤为关心的事情。

资产状态随着领用/归还自动变更的效果如下：

![](184dd9f00df0ace5ba0bdd76895bba82.jpg)

**2.** **功能简介**

上述场景可以通过公式设置搭配动作流功能实现，在资产领用时，用户可一次领用多个空闲中的资产，生成资产领用表；资产信息表中被领用的资产显示“已领用”，并记录领用人。 用户归还时，可以选择多个自己领用的资产，资产信息表中的资产恢复成“空闲中”；资产领用表中的归还状态会根据明细表中的信息而改变：当明细表中没有资产归还时，显示“未归还”；有部分资产归还时，显示“部分归还”；全部资产都归还时，显示“已全部归还”。

**3.** **操作说明**

**1.**新建资产信息表**

该表单记录了资产的详细信息，资产状态、领用人员等字段随着资产的领用/归还而变化：

![](d1cf48721e633a504896475a82a32c45.jpg)

**2.**资产领用**

**2.1**设计资产领用表**

在资产领用表中，首先是主表中的领用人，全部归还状态等字段，之后在明细表中添加关联e-Builder字段关联资产信息，资产规格、编号等字段通过关联表字段自动带出。

![](a20aef69e934d1221df6c247c5b48de1.jpg)

为了实现主表字段“全部归还状态”随着明细表中的“是否归还”而改变，实现未归还、部分归还、已全部归还。首先需要对明细表中的“是否归还”选项设置分数：“未归还”为0，“已归还”为1。

![](ea8e9b44a6e74e17377e39703499ed16.jpg)

接着在明细表中放入两个字段并隐藏起来：“状态值”字段利用“SCORE”函数取“是否归还”选项的分数；“明细数”字段默认为1，即有多少条明细，就记录多少个1：  
 ![](c56ecb1ee7903d3a5fc9cd05beac85fe.jpg)

设置完成后，在主表中增加两个字段，利用“SUM”函数分别计算明细表中合计的状态值与明细条数。这样搭配动作流（动作流在下文讲解），就能实现当“状态值合计≠0 and 状态值合计≠明细条数合计”时（即明细表中的物品并非一件未还，也并非全部归还），此时主表状态为“部分归还”；当“状态值合计=明细条数合计”时（即明细表中的物品全部归还），此时主表状态为“已全部归还”。

![](4373b43fe7b03369319e4cd8b4eedb5d.jpg)

**2.2**资产领用动作流**

用户进行资产领用申请，一次可申请多个资产，用户可申请多次，申请通过后资产状态改变。因为资产放在明细表中，所以利用循环-LENARRY函数进行明细表多次执行，从而更新资产信息表，动作流设置如下：

![](45da6280abbfc81d2ca1482c68f2545d.jpg)

**2.3**资产领用修改资产信息效果如下：**

![](079d519aa86de5318837c2174ba1d68e.jpg)

**3.**资产归还**

**3.1**搭建资产归还表单**

在资产归还表单中，用户可以一次性归还多个资产，并且不限制是哪次领用的，只要是未归还的都可进行归还。此时需要进行过滤，用户选择资产时只能选到自己领用的资产：

![](f1f289db11308f273fb975dd8803cde3.jpg)

**3.2**资产归还动作流**

资产归还时，首先修改资产信息表，对应的资产状态变成空闲，领用人置空：

![](a7ccd92822f7098d96cd8a0a06b9ea39.jpg)

之后修改资产领用表，修改该人员领用的资产明细：

![](b44e3568dc3f2e666553bf3ece308b75.jpg)

最后根据2.1中设置的两个字段进行比较，修改资产领用表总的状态，判断全部归还/部分归还。

判断部分归还动作流如下：

![](0507e45c1121f0e75fdb3e58a385b34f.jpg)

判断全部归还动作流如下：

![](d1895f5fdd3978776a7430c023348dfa.jpg)

需要注意的是，动作流的逻辑默认为从上往下依次执行，若中间有一个环节执行失败，则后续动作不再执行。因此在这里，每次按照条件进行归还状态的变更时，可能没有符合“部分归还”条件的数据，动作流报错，并且不会执行后面的“全部归还”。我们可以在判断“部分归还”的环节设置异常处理，如果没有找到符合条件的数据，就跳过当前节点：

![](a505c8a45517e8436a92beb6821fe5cb.jpg)

动作流整体概览如下：

**![](11f5abf9e549da179d6b6584c9a0b6c7.jpg)**

**3.3**最终的展示效果如下：**

![](33328f27ffe0a48dbe04e70630ee424e.jpg)