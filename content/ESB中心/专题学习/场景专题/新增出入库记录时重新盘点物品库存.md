---
aliases: ["1969527731887943933"]
title: 新增出入库记录时重新盘点物品库存
created: 2025-07-29
modified: 2025-07-29
tags: ['ESB中心']
theme: ESB中心
---

## 1. 场景说明

在采购管理中，物品入库和库存领用这两个环节至关重要，因为它们直接关系到物品库存的准确性和供应链的顺畅性。

为了保持库存的实时性和准确性，每一次出入库都需要对所有物品的历史入库记录和出库记录进行重新盘点。这个过程确保了我们能够得到所有物品最新总入库数量和总出库数量；同时，物品的实际库存数量始终等于总入库数量减去总出库数量。

这种方式不仅保障了库存数据的准确性，还为企业的供应链管理提供了有力支持。

以入库登记为例，入库前后库存变化情况如下图：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/80d9b1731f62cb1d64a31a2f7c510a95.jpg)

入库前库存情况

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/b7949831cf2e70def92e795c04295aba.jpg)

入库信息

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/5ccfb7253c140eb719632b29aeeb38c6.jpg)

入库后情况

## 2. 功能简介

登记入库时，对物品入库明细数据进行分组统计，以获得每个物品的历史入库数量。若库存明细表中没有该物品的库存数据，则新增一条数据，若有则更新该物品的库存数量和历史入库数量，其中库存数量=历史入库数量-历史出库数量。

库存领用时，对物品出库明细进行分组统计，以获得每个物品的历史出库数量，并更新库存明细表中的库存数量和历史出库数量，其中库存数量=历史入库数量-历史出库数量。

上述功能需要通过动作流实现，重点是配置动作流中的查询表单组件时需要选择相应的出入库明细进行查询，进而计算出历史出入库数量：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/d3542937e7ab566b3ee1c04c6244d4ec.jpg)

##

## 3. 操作说明

### 1. 新建业务表单

创建物品信息、入库单、出库单和库存明细表单，维护物品信息、库存信息和对应的出入库流水

### 2. 配置库存数量计算公式

进入库存明细表单，设置库存数量的计算公式为“历史入库数量-历史出库数量”

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/b4c8e433ea24c1ef31e7c16150860b54.jpg)

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/216475ea298172cd0a7c2bd20724a5dc.jpg)

### 3. 新建动作流

进入应用后台管理 > 设置 > 动作流 > 新建 ，以下动作流的配置以**订单入库**为例

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/9e32a9d171f233a2d7a04dbffe5ba397.jpg)

### 4. 添加动作流触发动作

当入库单保存（新建保存）、保存并新建或保存（编辑保存）时触发

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/665f57b19e8fe3217205ea3a5f4fafa0.jpg)

### 5. 添加“查询表单”操作

e-builder > 查询表单，对历史入库记录明细进行分组查询

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/ac59e87d65fb780a7ccd063ae50ab4c4.jpg)

### 6. 对查询表单节点进行配置

a. 数据源选择 业务模块 > e-builder表单 下相应入库单中的入库明细

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/4325491d241987ebca1bf08f87fd5cc5.jpg)

b. 条件为true，设置数据ID不为空

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/65615550e41bf5648e29f44009b9cc07.jpg)

c. 查询方式选择“分组/汇总”，分组字段为入库物品，汇总内容为对入库数量求和

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1c5b776a6763adbd3c6ad9e97407d16f.jpg)

### 7. 添加“循环”操作

添加 内置操作 > 逻辑组件 > 循环，以 查询表单 操作返回的各物品历史入库数量为依据明细

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/d376e89699e1a7b375aeaf2752ec56f9.jpg)

### 8. 对循环节点进行配置

a. 指定次数适用于固定循环次数的情况，指定条件适用于不确定循环次数的情况，而这里是根据所查询到的产品入库数据来进行循环，所以循环方式选择 指定数据

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/4d82aa0d3e727f1027c7e22a2c5f4fca.jpg)

b. 明细数据为上面查询节点所查询到的各物品历史入库明细

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/b63af0a3e100fc608213c9e4dc0484bc.jpg)

###

### 9. 在循环內添加“更新表单数据“操作

添加 数据操作 > 更新数据 > 更新表单数据，用于更新对应每个物品在物品信息表单中存储的入库数量

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/c7667ac8e19f0a5dfdb6a3483b565f89.jpg)

### 10. 对更新表单数据节点进行配置

a. 选择对应的应用和表单、操作人，类型选择 按字段更新 ，更新策略为 更新全部数据 ，更新条件选择 物品 字段 ，打开 条件不满足时插入

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1362867bebe140c398412b32fbd9610f.jpg)

b. 设置表单数据时，勾选启用数据钻取及计算，物品动态赋值为循环节点获取到的产品信息，入库数量动态赋值为循环节点获取到的入库数量的合计值，其余字段均为原值

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/6e6249e76f5fe3ecbd3989ae2c973a13.jpg)

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/51538362c713538c9e7f9f8123fe9302.jpg)

### 11. 保存动作流并验证

