---
aliases: ["1972126729430637198"]
title: 连接器集成千里聆第三方应用实现上传发票文件自动识别发票信息生成票据台账
created: 2025-07-29
modified: 2025-07-29
tags: ['ESB中心']
theme: ESB中心
---

**1.编写目的**

本期主要讲解财务报销管理的发票识别场景。为方便企业员工录入发票信息，快捷管理个人财务报销，要求员工录入发票信息时支持系统根据上传的发票问价自动识别发票信息并且回填到发票信息形成发票台账。如下图所示，在我的票价台账上可进行发票上传和管理。点击【上传发票】按钮打开发票信息的新建布局，用户上传发票图片，后台调用千里聆的发票识别接口识别文字信息以及发票的可信度，并将识别结果回填到当前布局的其他字段中。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1c121da4786c2cb727db831e1b7071c7.jpg)

本场景中通过ESB中心连接器管理第三方发票识别接口调用方式，自定义触发动作流实现接收表单布局字段作为接口请求参数，调用连接器维护好的图像识别接口发起请求，并将接口识别结果输出到表单布局，表单引擎字段联动实现绑定触发时机和触发动作。

**2.思路分析**

在ESB中心连接器维护第三方应用接口的调用方式，如请求地址、请求方式、请求响应参数的数据格式等；自定义触发动作流添加输入参数用于接收表单引擎上传的图片信息，添加执行组件调用连接器维护的接口并将接收到的图片信息转码后作为请求参数发起图像识别请求，设计输出参数格式接收接口识别结果；在发票信息表单添加字段联动规则，当上传发票的图片字段值改变时，触发上步骤的动作流，将图片字段值映射为输入参数，输出字段映射到表单布局的其他字段。

**3.操作步骤**

**3.1参照千里聆的发票识别接口使用文档维护第三方应用连接器**

3.1.1第三方接口使用文档[[#_12-发票智能识别服务|点击查看千里聆发票识别接口使用文档]]

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/9eea6ca5f96744964b8fc67ba43c01c8.jpg)

图1 接口使用文档说明

3.1.2新建第三方应用连接器

在后台管理中心-ESB中心-连接器-第三方应用，新建连接器，选择连接类型，完善连接器名称、所属企业和所属产品等信息

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/bff591967e395d1146a79cd546a0e025.jpg)

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/9cde6fc37b62c19b3b588f9162e25f28.jpg)图2、3新建连接器

3.1.3新建连接

根据第三方提供的开放接口文档，完善协议类型、IP地址和编码等信息，如接口的请求地址:<https://open.easst.cn/openapi/rest/common/invoiceocr，域名/IP地址维护到https://open.easst.cn就行了>

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/2200797738f2990ec5248173244487c9.jpg)

图4 新建连接

3.1.4新建接口

基本信息的请求地址维护域名后面的内容即可，如接口的请求地址是:https://open.easst.cn/openapi/rest/common/invoiceocr，请求地址就是lopenapi/rest/common/invoiceocr>请求方式是POST

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1d80414c239e131704416e831e868a16.jpg)

图5 新建接口，维护基础信息

3.1.5根据接口使用说明配置请求参数的位置和数据格式

参数appld、timestamp和sign需要放在请求头header，参数image\_data放在请求消息体body中

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/9336c51e55838fa542e1b49fa9b21ee5.jpg)

图6 维护接口请求参数

3.1.6根据接口文档示例数据配置响应参数的数据格式

其中因为result和commodity\_info是数组类型的参数对象所以需要启用数组

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/9a11b6362699a4392762b803d278bbc4.jpg)

图7 维护响应参数数据格式

3.1.7设置成功条件

当响应参数isSuccess返回true的时候代表执行成功

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/9147780fade8407f88ffde8ac8ca93d9.jpg)

图8 设置成功条件

3.1.8匹配连接和发布接口

接口创建保存后需要手动选择关联连接，将状态由维护切换到发布后才能调用

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/96aced342e452e0b02abc72c7b0119f5.jpg)

图9 接口关联连接并发布

**3.2设计发票表单**

图片组件用于发票文件上传(如果文件格式需要兼容PDF需要改成附件字段)>添加其余主表字段和明细字段用于存储发票识别结果

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/508d0810ebbcf6933fcf0f069e0178a6.jpg)

图10 发票信息表单设计

**3.3设置自定义触发动作流调用连接器接口**

3.3.1整体步骤：先创建自定义触发动作流，接收发票图片作为传入参数，调用连接器接口进行图像识别，输出查询结果显示在表单布局上

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/2e43a6a05931e98a9131691701a0e2ca.jpg)

图11 自定义触发动作流整体思路

3.3.2接口调用组件设置输入参数

点击输入参数配置，设置header和Body请求参数；部分参数需要经过函数公式动态赋值，如将图片文件转码成base64

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/e505cb0dd68ca842916f0e608c75fd9d.jpg)

图12 输入参数设置

3.3.3配置输出参数

通过动态赋值从上下文-连接器组件-responseBody下获取接口的响应参数，将其映射给对应的输出参数

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/574853ded823e08cc1cd9c367b2355f6.jpg)

图13 输出参数配置

**3.4发票表单设置字段联动引用动作流**

为发票表单创建字段联动规则，触发动作是图片上传组件值改变时，查询方式选择ESB动作流，选择上步骤搭建的自定义触发动作流分别映射输入参数和输出参数

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/ec85655253cfa84c4f08665338a213e0.jpg)

