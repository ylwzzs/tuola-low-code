---
aliases: ["1967506944379763171"]
title: 从第三方平台查询数据并录入本地
created: 2025-07-29
modified: 2025-07-29
tags: ['ESB中心']
theme: ESB中心
---

**1.** **场景说明**

在财务记账管理应用中，凭证查询列表的数据并不是由低代码平台手动新建产生，而是从金蝶精斗云云会计财务套账的凭证列表中查询录入生成。像这样从第三方平台查询数据并将其导入低代码平台应用的功能是通过连接器和动作流实现的。

展示效果如下图所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/b80ae2c8d4298725ec27ae197ca7dcaf.jpg)

**2.** **功能简介**

在系统连接器中新建金蝶精斗云连接器，参考金蝶开放平台提供的API使用文档维护连接器的连接和接口信息。在财务记账管理应用中设计凭证查询表单作为外部数据导入系统的存储载体，新建查询按钮作为数据查询和录入的功能入口，配置动作流实现点击该按钮时调用连接器接口向精斗云云会计发起查询请求，然后将响应数据写入财务记账管理的凭证查询表单。

**3.** **操作说明**

1. 在后台管理中心->ESB中心->连接器页面，新建系统连接器，并参金蝶开放平台开发者文档维护连接信息和接口信息，在本专题中需要维护获取用户access\_token和凭证查询两个接口，如图１所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/a9285aef97de37495860e45a0b1d80ea.jpg)

图1 配置连接器

2. 在财务记账管理应用中设计凭证查询表单存储从精斗云云会计查询得到的凭证信息，注意表单字段类型和表单结构要和源表单（即云会计财务套账的凭证表单）保持一致，如图2所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/3f947dc3d4dfa17bf87d56c846d1f6ba.jpg)图2 设计数据存储表单

3. 设计查询按钮作为查询和录入数据的功能入口，其中按钮位置为凭证查询表单表格视图的右上角，如图3所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/e15aeacaf1bfee0e10fdf881f960e529.jpg)

图3 设计查询功能触发按钮

4. 新建动作流，配置触发事件为点击查询按钮，如图4所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/40373025e051b5b38cc722f24007fbad.jpg)

图4 新建动作流配置触发时机

5. 添加执行动作，调用连接器接口，配置参数和消息体数据，向第三方平台发起请求获得响应数据。参考金蝶API文档，凭证查询接口有三个必填参数分别是access\_token,sID和sbId。其中后两者都可以在精斗云用户账号中直接获取，而第一个参数需要通过调用另一个获取用户access\_token的接口动态获取。

因此新增的第一个执行动作是连接器-获取用户access\_token，点击输入参数配置，参考接口文档为参数赋值，如图5、6、7所示:

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1d6e1984e7f7ca5d1c9450cb961977f8.jpg)

图5 添加执行动作为连接器-精斗云-获取用户的access\_token

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/bbf7d3e8400c314f8a7c6fccf19fb829.jpg)

图6 动作节点获取用户access\_token

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/a8962e899ce561f2d173dae968cf35cd.jpg)

图7 配置调用获取用户access\_token接口所需参数值

创建第二个执行动作连接器-查询凭证，如图8所示。点击输入参数配置，为各参数赋值，其中access\_token参数值从上一执行动作的响应消息体中获取，如图9所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/79ff659e87095c64eaecd8a9b5fed422.jpg)

图8 新建执行动作为连接器-精斗云-查询凭证

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1ab22586bbe33f0996f96a9505014231.jpg)

图9 从上一个执行动作的响应消息体中获取access\_token

创建第三个执行动作内置-多次执行，标准应用-e-builer-新增表单数据，将上一动作收到的响应数据中凭证集合信息依次插入到本应用的凭证查询表单中，如图10所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/2eb0371117320f59ab833677947e74dc.jpg)

图10 将查询响应结果数据保存到低代码平台应用表单中

其中循环次数为查询到的凭证数量，计算集合元素的个数使用动作流函数中的LEN\_ARRAY，而函数运算对象则是上一查询动作响应消息中的凭证集合字段items，（也可以直接使用查询动作响应消息中的totalsizezi参数作为循环次数）如图11所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/814fda2979ad173defa75667e4e699a6.jpg)

图11 新建表单数据的条数为第三方平台响应数据的条数

配置表单数据时，数据来源为查询表单动作的响应消息体即responseBody,参考API接口文档将表单字段和响应数据字段一一匹配，如图12所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/1578849ee00c27b4827236ab50219302.jpg)

图12 第三方平台响应数据字段和表单字段一一对应

在匹配凭证分录明细子表字段数据时，依据值为响应数据中分录集合字段即entris，子表字段赋值方式为依据值下级，后面的赋值框会自动识别该集合下的子元素字段以供选择，如图13所示：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/669b8e67e35f2ffe99ade244533ebbce.jpg)

图13 低代码平台表单明细表和查询响应数据的明细匹配规则

6. 动作流完成之后的实现效果如图14所示：

点击查询按钮，触发动作流，动作流执行成功，凭证查询列表会新增查询记录。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/fbf374f8a0610f9c9192d96db804688e.jpg)

