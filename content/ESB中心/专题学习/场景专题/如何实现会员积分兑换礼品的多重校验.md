---
aliases: ["1967592105916870910"]
title: 如何实现会员积分兑换礼品的多重校验
created: 2025-07-29
modified: 2025-07-29
tags: ['ESB中心']
theme: ESB中心
---

**1. 场景说明：**

在【会员管理】场景中，会员发起礼品兑换申请后，可以对会员当前卡内积分与兑换礼品所需积分，以及兑换礼品个数和礼品库存个数进行比对校验。

若校验不通过则提示“消耗积分大于卡内积分/礼品库存不足，请更改！”并阻止后续操作；若校验通过则将兑换的礼品信息插入到会员信息中，并更改会员卡内积分信息以及礼品管理中的礼品库存信息。

*展示效果如下图所示：*

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/336c7c7049539f8092145f4d0e500dfa.jpg)

**2. 功能简介：**

本场景所使用的动作流是利用【触发事件】--【点击按钮时】触发，添加【执行动作】--【标准应用】--【e-builder】--【表单查询】辅助执行动作，触发【执行动作】--【内置】--【条件分支】进行数据校验，根据当前数据的校验结果，对后续操作进行阻止或执行。若校验不通过则会触发【执行动作】--【内置】--【页面交互】阻止后续操作；若校验通过则会触发【执行动作】--【标准应用】--【e-builder】--【修改表单数据】对相关数据进行更新修改。

**3. 操作说明**

（1） 首先选择【触发事件】--【点击按钮时】触发，配置对应应用和表单，选择其触发按钮为新增类型按钮（新建保存、保存并新建、批量新增以及导入），并选择其触发位置为执行前，触发类型为依次触发。

因为本动作流需要在生成数据之前对其进行校验，所以按钮触发位置设置为执行前。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/e38dbb228db0f51a7b60a91c0d6119cc.jpg)

（2） 添加【执行动作】--【标准应用】--【e-builder】--【表单查询】执行动作。并配置对应数据源、条件、数据权限、操作人以及查询方式。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/153ef5b3bdcd4b6ce664150f01392184.jpg)

因后续动作流配置需要“会员信息”和“礼品管理”表单数据，所以此处添加2个【表单查询】辅助执行动作，带出所需数据。

“会员信息”表单查询设置如图：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/ebfd5117adecf87ea61e6c247538326e.jpg)

“礼品管理”表单查询设置如图：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/4f90790f38784a17adfbe6a672ab921d.jpg)

（3） 选择【执行动作】--【内置】--【条件分支】进行数据校验配置。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/0ca60c354bc9d9e6823502410f831526.jpg)

根据数据校验要求，配置不同执行条件。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/58371e11a2bfc5452ad745e9f67e25cb.jpg)

条件1配置为（（消耗积分大于“卡内积分”）OR（兑换个数大于“礼品库存）”）。

因为当消耗积分大于卡内积分和兑换个数大于礼品库存两个条件，若满足其中一条则提示报错阻止后续操作，所以条件关系选择为OR。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/2d3a9800427700904aa0e66bc0beba1e.jpg)

其中需要注意的是，在配置“卡内积分”和“礼品库存”时，要将目标变量中的“全部”改为“0”。因为该字段来自于上述【表单查询】执行动作，所以要对此数据进行数据遍历查询，此处的“0”则表示从第一条数据开始查询，且查询结果为唯一值。

卡内积分目标变量配置：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/c5903e8f27bf10bd376c3801b2f02e8c.jpg)

礼品库存目标变量配置：

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/fd5aa35dbe3e2fd4dafbab9a63c3f595.jpg)

条件2配置为（（消耗积分小于等于“卡内积分”）AND（兑换个数小于等于“礼品库存）”）。

因为当消耗积分小于等于卡内积分和兑换个数小于等于礼品库存两个条件被同时满足时，才可以执行该条件分支，所以条件关系选择为AND。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/f3045873abe662e2ea9e44429367092d.jpg)

具体“目标变量”配置与上述内容一致，这里不做重复赘述。

（4） 若满足条件1，则会触发【执行动作】--【内置】--【页面交互】，提示固定值“消耗积分大于卡内积分/礼品库存不足，请更改！”并阻止后续操作。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/31dbeafac8db2b545da3fe9910f427b6.jpg)

（5） 若满足条件2，则触发对应的“修改表单数据”执行动作。

修改【会员信息】表单中的卡内积分，并将兑换的礼品信息插入进来。

![](https://myhelpdoc.oss-cn-heyuan.aliyuncs.com/mdimages/910c113d711c2bb985319aa1f8b84d60.jpg)

并且同步减少【礼品管理】表单中的礼品库存。

