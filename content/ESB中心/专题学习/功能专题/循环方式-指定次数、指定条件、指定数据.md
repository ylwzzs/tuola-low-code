---
aliases: ["1969534796910943947"]
title: 循环方式-指定次数、指定条件、指定数据
created: 2025-07-15
modified: 2025-07-15
tags: ['ESB中心']
theme: ESB中心
---

本文档将介绍动作流中循环组件涉及到的三种循环方式的使用场景和使用方法：

![](ce42a9342c15e8b0bffde0bb233980b2.jpg)

三种循环方式的主要区别在于进入循环的时候是否已知循环次数：

指定次数：适用于已知循环次数的情况，循环次数设置为整数，通常会用到 [[LEN\_ARRAY函数|LEN\_ARRAY]] 函数

指定条件：适用于不确定循环次数的情况，循环的次数取决于循环内组件的执行结果，只要条件满足，循环将一直执行下去

指定数据：适用于遍历数据集合中的数据，如明细表，循环会持续执行直到遍历完所有的数据为止

## 1. 指定次数

### 适用场景

指定次数循环通常用于已知循环次数的情况，循环次数可以是一个固定的整数、数组的元素个数，或者数据集合的行数等。总之，在第一次进入循环的时候，我们就能获知循环要执行的次数

### 场景示例

在采购管理场景中，会涉及到提报采购需求并根据采购申请审批结果更新采购需求状态的情况，详细场景如下：

➢ 提报采购需求：当有需求时，相关人员可以填写采购需求表单，将采购需求的详细信息提交，此时采购需求的状态标记为“已提报需求”

![](27a4ad91a70f417b3b9a85a9c6d67b6c.jpg)

➢ 发起采购申请：基于已提报的采购需求，可以生成相应的采购申请。一个采购申请可以包含多个采购需求，以便进行批量处理。

![](8f1240439f2d71ab4bf0d3e6fdd8d1e5.jpg)

➢ 采购申请审批：采购申请进入审批流程，审批通过后，相应采购需求的状态将更新为"已通过审批"

![](32077311eb41003acfaab479c19d1115.jpg)

### 实现步骤

#### 1. 新建业务表单并搭建采购申请工作流

创建物品信息、采购需求和采购申请表单，用于维护物品信息、提报采购需求和发起采购申请，并创建采购申请流程

#### 2. 规划动作流实现思路

由于状态的更新是在采购申请流程审批通过后执行的，所以动作流的触发类型应该为 流程事件触发

一条采购申请中包含多个采购需求，每个采购需求的状态都需要更新，所以需要使用循环组件多次执行更新表单数据操作

指定的次数即为通过[[LEN\_ARRAY函数|LEN\_ARRAY]] 函数计算出的该采购申请中包含的需求数量

#### 3. 创建动作流

##### 3.1. 配置触发动作

触发类型为流程事件触发，工作流选择采购申请流程，触发时机为审批节点后

![](e7dbff0e962e2375f47d95fc58372afd.jpg)

![](8e5457fd0078efab6e880bcdd8f2e7ec.jpg)

##### 3.2. 配置循环节点

循环方式为指定次数，循环次数则是通过[[LEN\_ARRAY函数|LEN\_ARRAY]] 函数计算采购需求的个数

![](cd01a1c5ff3ad9385aab82f7337a1cd8.jpg)

##### 3.3. 配置更新表单数据节点

应用、表单按需选择，操作人设置为当前操作者，类型为按数据ID更新，数据ID动态赋值为采购需求字段

但由于这里的采购需求为list类型，所以需要根据已循环次数去获取本次循环下获取到的单个采购需求ID

![](b8c1e628f88f4b3a03e29d79b799f8db.jpg)

设置表单数据时，将需求状态设置为已通过审批即可

![](071c2b41a5135285ac15f50528a1834d.jpg)

## 2. 指定条件

### 适用场景

指定条件通常用于循环次数不确定的情况，次数取决于循环内组件的执行结果，例如通过接口获取第三方数据的时候，可利用接口返回总条数作为条件来判断是否需要继续执行该接口，直到总条数达到要求退出循环

### 场景示例

在证照管理场景中，我们需要维护不同的证照类型，这些证照类型之间存在层级关系。当我们需要删除某个上级证照类型时，还需同时删除其下属的多个子证照类型。

如下图所示，若点击编号为0002的建筑资质证书行末的删除按钮，那么所框选出来的一级、二级、三级证书均会被删除

![](644d591c1b24d3234a0b2c23c37f5919.jpg)

### 实现步骤

#### 1. 新建业务表单

搭建证照类型表单、录入数据，并将删除按钮显示在行上，通过点击该按钮删除证照类型数据

#### 2. 规划动作流实现思路

在删除某一证照类型的时候，还需要判断该证照类型是否有下级类型。若有下级类型，则需要一并删除，以此类推，如果下级类型也有下级，则需要逐层循环判断并删除。但在实际项目中，应尽量避免删除业务数据，所以我们可以在证照类型表单中增加一个状态字段，用于标记数据的删除状态，例如：0表示未删除，1表示已删除。

根据上述需求，这里还需要两个参数来记录过程中的变量，用于循环的判断依据：

index：记录当前证照类型的下级个数，类型为整数

series\_ id：记录这些下级证照的数据ID，类型为文本

详细的设计思路见下图：

![](d0c1fee6ce65e8d6e053e724019a02ba.jpg)

#### 3. 创建动作流

配置动作流时，请对照上述设计思路图，配置步骤与图中的节点一一对应

##### 3.1. 触发动作

触发类型为e-builder事件触发，选择的按钮为删除按钮

![](27437834fad9235dcaeb8eb6b32766e1.jpg)

##### 3.2. 更新表单数据1

选择按数据ID更新，并将状态字段的值设置为1

![](da0f5ce9a12879011ec56b51ba45f4dc.jpg)

##### 3.3. 查询表单1

查询当前所选择的证照类型的下级数据，并返回总数

![](c97e64d77e80f9a704e7baa7733fd6f6.jpg)

##### 3.4. 变量赋值1

将“查询表单1”中返回的总数，即下级证照类型的个数，赋值给index

![](183e1eac6df2dd3c07038406ae66bc04.jpg)

##### 3.5. 变量赋值2

将“查询表单1”中查询到的所有下级证照类型的数据ID，赋值给series\_ id

![](496484a436037ba12918f3414b86318a.jpg)

##### 3.6. 循环

循环方式为指定条件，循环条件为index>0

![](e1349d75d6d2c419a5a8db8a15d4e550.jpg)

##### 3.7. 循环內-更新表单数据2

选择按条件更新，并将series\_ id字符串转换成数组作为条件，更新表单中的状态字段值为1

![](fcf78d758657fdb436996033a362aebc.jpg)

##### 3.8. 循环內-查询表单2

将series\_ id转换成数组，查询表单数据的条件为表单字段“上级”属于该数组，其他配置同“查询表单1”

![](9b3da84e7d266e0287179df9ddcc73ef.jpg)

##### 3.9. 循环内-变量赋值3

将上一步骤中返回的总数赋值给变量index，配置同“变量赋值1”

##### 3.10. 循环内-变量赋值4

将循环内的查询表单2操作查到的所有数据的数据ID字段赋值给series\_ id，配置同“变量赋值2”

## 3. 指定数据

### 适用场景

指定数据循环通常适用于遍历数据集合中的数据，也就是系统中类型为LIST的数据，比如明细表、数组等

使用的场景也非常多，例如库存管理中，进行入库操作时，很可能一次性入库多个产品，这时候就需要分别去更新每个产品对应的库存量，这种情况下，用指定数据循环就非常合适

### 场景示例

在采购管理中，提出采购申请时，会涉及到多种物品，且需要填写每种物品的期到货日期，为了保证填报的数据质量，避免误填，需要对明细数据进行逐校验，保证到货日期均晚于数据填报日期

![](d7cf56838e7acd03f85e991f24afe3dc.jpg)

### 实现步骤

#### 1. 新建业务表单

搭建采购申请表单，其中包含申请单号、申请人、申请日期、采购明细等内容

![](a6649224681d2720bfe1e116f8950a63.jpg)

#### 2. 规划动作流实现思路

在对明细表逐行数据进行校验的时候，不仅要校验数据是否符合要求，还需要记录错误数据的行号，在界面上反馈给填写人

基于上述需求，这里还需要参数来记录错误的行号并且拼接起来，反馈到界面

index：记录数据填写错误的行号，类型为整数

error\_line：将错误行号进行拼接，格式为：1、2、3，类型为文本

详细的设计思路见下图：

![](0e252230beb4658741bad222d953c205.jpg)

#### 3. 创建动作流

配置动作流时，请对照上述设计思路图，配置步骤与图中的节点一一对应

##### 3.1. 触发动作

由于是做数据校验，若填写错误则不能上报数据，所以要在数据归档前完成校验动作

![](ba9e5e415dda83277344b1dc26635d20.jpg)

##### 3.2. 循环

循环方式选择指定数据，明细数据为采购需求明细表

![](8bc4a140ca8c83a8690547b7a78ba004.jpg)

##### 3.3. 循环内-分支1

分支执行方式选择排他分支，条件1中的条件设置为期望到货日期大于今天

![](d17b905730a544e4093bf0c4675d1cde.jpg)

##### 3.4. 循环内-变量赋值1

若所填写的期望到货日期小于今天，那么需要将这个错误数据的行号赋值给index

由于循环次数是从0开始的，但是大家的日常认识里表格的行数时从1开始的，所以需要在循环次数的基础上加1，再把值赋给index

![](9184e6be619ac35469b4ccd67eb669a7.jpg)

##### 3.5. 循环内-分支2

用于判断error\_line是否为空

![](8f14d95292ffbe741cfff479a7c8d6bd.jpg)

##### 3.6. 循环内-变量赋值2

若error\_line为空，则直接把index转换成文本后的值赋给它即可

![](c0dc727cf24361aaf8d1a9ff32aa5682.jpg)

##### 3.7. 循环内-变量赋值3

若error\_line不为空，则需要在error\_line原值的基础上使用“、”将index拼接进来

![](9bf17e813c1812ee193cc939861cd9af.jpg)

##### 3.8. 分支3

用于判断error\_line是否为空

![](17466a7b35502f4bde0b482f7db43835.jpg)

##### 3.9. 页面交互

若error\_line不为空，则在填报界面上给出一条友好的提醒，并且阻止后续操作，不允许数据提交入库

![](ffe4ed0aec7e6489ce7fe93bd2fa16af.jpg)